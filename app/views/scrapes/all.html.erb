<% content_for :title, "iAFS - Alla AFSar" %>

<div class="mb-8">
  <div class="bg-white rounded-lg shadow-lg p-8">
    <h1 class="text-3xl font-bold text-slate-800 mb-2">Alla AFSar</h1>
    <p class="text-lg text-slate-600 mb-6">
      <%= t('headings.all_afs_subtitle') %>
    </p>
    
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
      <div class="text-center p-4 bg-slate-50 rounded-lg">
        <span class="block text-3xl font-bold text-slate-800"><%= @stats[:total_scrapes] %></span>
        <span class="text-sm text-slate-600 uppercase tracking-wide"><%= t('nouns.booklet', count: @stats[:total_scrapes]) %></span>
      </div>
      <div class="text-center p-4 bg-slate-50 rounded-lg">
        <span class="block text-3xl font-bold text-slate-800"><%= @stats[:total_articles] %></span>
        <span class="text-sm text-slate-600 uppercase tracking-wide"><%= t('nouns.paragraph', count: @stats[:total_articles]) %></span>
      </div>
      <div class="text-center p-4 bg-slate-50 rounded-lg">
        <span class="block text-3xl font-bold text-slate-800"><%= @stats[:total_general_recommendations] %></span>
        <span class="text-sm text-slate-600 uppercase tracking-wide"><%= t('nouns.recommendation', count: @stats[:total_general_recommendations]) %></span>
      </div>
      <div class="text-center p-4 bg-slate-50 rounded-lg">
        <span class="block text-3xl font-bold text-slate-800"><%= @stats[:total_appendices] %></span>
        <span class="text-sm text-slate-600 uppercase tracking-wide"><%= t('nouns.appendix', count: @stats[:total_appendices]) %></span>
      </div>
    </div>
    
    <% if @stats[:last_updated] %>
      <p class="text-sm text-slate-500 mb-4">
        <em><%= t('headings.last_updated') %>: <%= @stats[:last_updated].strftime("%Y-%m-%d kl %H:%M") %></em>
      </p>
    <% end %>
    
    <%= link_to t('buttons.back'), root_path, class: "inline-block px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded-lg transition" %>
  </div>
</div>

<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
  <% @scrapes.each do |scrape| %>
    <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition">
      <div class="bg-slate-100 px-6 py-4 border-b border-slate-200 flex justify-between items-start">
        <h3 class="text-xl font-bold text-slate-800"><%= regulation_name(scrape.source.url) %></h3>
        <div class="text-right text-xs text-slate-600 space-y-1 ml-4">
          <div>ðŸ“‹ <%= article_count(scrape.raw_html) %> <%= t('nouns.paragraph', count: article_count(scrape.raw_html)) %></div>
          <div>ðŸ’¡ <%= general_recommendation_count(scrape.raw_html) %> <%= t('nouns.recommendation', count: general_recommendation_count(scrape.raw_html)) %></div>
          <div>ðŸ“Ž <%= appendix_count(scrape.raw_html) %> <%= t('nouns.appendix', count: appendix_count(scrape.raw_html)) %></div>
        </div>
      </div>
      
      <div class="px-6 py-4 bg-white">
        <p class="font-semibold text-slate-700 mb-3 leading-tight">
          <%= regulation_title_subject(scrape.title) %>
        </p>
        <p class="text-sm text-slate-600 italic leading-relaxed">
          <%= section_preview(scrape, 200) %>
        </p>
      </div>
      
      <div class="px-6 py-4 bg-slate-50 border-t border-slate-200 flex gap-2">
        <%= link_to t('buttons.show'), raw_scrape_path(scrape), class: "flex-1 text-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition font-medium", target: "_blank" %>
        <%= link_to t('buttons.source'), scrape.source.url, class: "flex-1 text-center px-4 py-2 border border-blue-600 text-blue-600 hover:bg-blue-600 hover:text-white rounded-lg transition font-medium", target: "_blank" %>
      </div>
    </div>
  <% end %>
</div>

<% if @scrapes.empty? %>
  <div class="text-center py-12 bg-white rounded-lg shadow">
    <h3 class="text-xl font-semibold text-slate-700 mb-2"><%= t('empty.no_content') %></h3>
    <p class="text-slate-600 mb-4"><%= t('empty.run_jobs_tip') %></p>
    <pre class="inline-block bg-slate-100 px-4 py-2 rounded text-sm font-mono"><code>rails scrape:all</code></pre>
  </div>
<% end %>
