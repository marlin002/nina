<% content_for :title, "iAFS - Alla AFSar" %>

<div class="scrapes-header">
  <h1><%= link_to "iAFS", root_path, class: "home-link" %></h1>
  <p class="subtitle">
    <%= t('headings.all_afs_subtitle') %>
  </p>
  
  <div class="stats-summary">
    <div class="stat-item">
      <span class="stat-number"><%= @stats[:total_scrapes] %></span>
      <span class="stat-label"><%= t('nouns.booklet', count: @stats[:total_scrapes]) %></span>
    </div>
    <div class="stat-item">
      <span class="stat-number"><%= @stats[:total_articles] %></span>
      <span class="stat-label"><%= t('nouns.paragraph', count: @stats[:total_articles]) %></span>
    </div>
    <div class="stat-item">
      <span class="stat-number"><%= @stats[:total_general_recommendations] %></span>
      <span class="stat-label"><%= t('nouns.recommendation', count: @stats[:total_general_recommendations]) %></span>
    </div>
    <div class="stat-item">
      <span class="stat-number"><%= @stats[:total_appendices] %></span>
      <span class="stat-label"><%= t('nouns.appendix', count: @stats[:total_appendices]) %></span>
    </div>
  </div>
  <% if @stats[:last_updated] %>
    <p class="last-updated">
      <em><%= t('headings.last_updated') %>: <%= @stats[:last_updated].strftime("%Y-%m-%d kl %H:%M") %></em>
    </p>
  <% end %>
  
  <div class="back-link-section">
    <%= link_to t('buttons.back'), root_path, class: "btn btn-secondary" %>
  </div>
</div>

<div class="regulation-grid">
  <% @scrapes.each do |scrape| %>
    <div class="regulation-card">
      <div class="regulation-header">
        <h3><%= regulation_name(scrape.source.url) %></h3>
        <div class="regulation-stats">
          <span class="stat">ðŸ“‹ <%= article_count(scrape.raw_html) %> <%= t('nouns.paragraph', count: article_count(scrape.raw_html)) %></span>
          <span class="stat">ðŸ’¡ <%= general_recommendation_count(scrape.raw_html) %> <%= t('nouns.recommendation', count: general_recommendation_count(scrape.raw_html)) %></span>
          <span class="stat">ðŸ“Ž <%= appendix_count(scrape.raw_html) %> <%= t('nouns.appendix', count: appendix_count(scrape.raw_html)) %></span>
        </div>
      </div>
      
      
      <div class="regulation-subject">
        <p class="subject-text">
          <%= regulation_title_subject(scrape.title) %>
        </p>
      </div>
      
      <div class="regulation-preview">
        <p class="preview-text">
          <%= section_preview(scrape, 200) %>
        </p>
      </div>
      
      <div class="regulation-actions">
        <%= link_to t('buttons.show'), raw_scrape_path(scrape), class: "btn btn-primary", target: "_blank" %>
        <%= link_to t('buttons.source'), scrape.source.url, class: "btn btn-outline", target: "_blank" %>
      </div>
    </div>
  <% end %>
</div>

<% if @scrapes.empty? %>
  <div class="empty-state">
    <h3><%= t('empty.no_content') %></h3>
    <p><%= t('empty.run_jobs_tip') %></p>
    <pre><code>rails scrape:all</code></pre>
  </div>
<% end %>
