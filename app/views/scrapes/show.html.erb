<% regulation_num = @scrape.source.url.match(/afs-2023(\d+)/)&.[](1) || "?" %>
<% content_for :title, "AFS 2023:#{regulation_num} - Full Content" %>

<div class="scrape-show-header">
  <%= link_to scrapes_path, class: "back-link" do %>
    ‚Üê Back to Index
  <% end %>
  
  <div class="scrape-info">
    <h1>AFS 2023:<%= regulation_num %></h1>
    
    <div class="scrape-metadata">
      <div class="metadata-item">
        <strong>Source URL:</strong>
        <%= link_to @scrape.source.url, @scrape.source.url, target: "_blank", class: "source-link" %>
      </div>
      
      <div class="metadata-item">
        <strong>Scraped:</strong>
        <%= @scrape.fetched_at&.strftime("%Y-%m-%d at %H:%M:%S") %>
      </div>
      
      <div class="metadata-item">
        <strong>Content Size:</strong>
        <%= number_to_human_size(@scrape.raw_html&.length || 0) %> HTML,
        <%= number_to_human_size(@scrape.plain_text&.length || 0) %> text
      </div>
      
      <div class="metadata-item">
        <strong>Version:</strong>
        <%= @scrape.version %> 
        <% unless @scrape.current? %>
          <span class="version-status">(Historical)</span>
        <% end %>
      </div>
    </div>
    
    <div class="action-buttons">
      <%= link_to "Raw HTML View", raw_scrape_path(@scrape), 
                  class: "btn btn-secondary", target: "_blank" %>
      <%= link_to "Original Source", @scrape.source.url, 
                  class: "btn btn-outline", target: "_blank" %>
      
      <% if @scrape.all_versions.count > 1 %>
        <div class="version-info">
          <%= link_to "View All Versions (#{@scrape.all_versions.count})", "#", 
                      class: "btn btn-info" %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<div class="scrape-content-tabs">
  <div class="tab-buttons">
    <button class="tab-button active" data-tab="formatted">Formatted Content</button>
    <button class="tab-button" data-tab="plain-text">Plain Text</button>
    <button class="tab-button" data-tab="raw-html">Raw HTML</button>
  </div>
  
  <div class="tab-content active" id="formatted">
    <div class="formatted-content">
      <%= @scrape.raw_html&.html_safe %>
    </div>
  </div>
  
  <div class="tab-content" id="plain-text">
    <div class="plain-text-content">
      <pre><%= @scrape.plain_text %></pre>
    </div>
  </div>
  
  <div class="tab-content" id="raw-html">
    <div class="raw-html-content">
      <pre><code><%= html_escape(@scrape.raw_html) %></code></pre>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const tabButtons = document.querySelectorAll('.tab-button');
  const tabContents = document.querySelectorAll('.tab-content');
  
  tabButtons.forEach(button => {
    button.addEventListener('click', function() {
      const targetTab = this.dataset.tab;
      
      // Remove active class from all buttons and contents
      tabButtons.forEach(btn => btn.classList.remove('active'));
      tabContents.forEach(content => content.classList.remove('active'));
      
      // Add active class to clicked button and corresponding content
      this.classList.add('active');
      document.getElementById(targetTab).classList.add('active');
    });
  });
});
</script>