<% content_for :title, "iAFS" %>

<% if @query_error.present? %>
  <div class="text-center py-12 bg-white rounded-lg shadow border border-red-200">
    <h3 class="text-xl font-semibold text-red-600 mb-2">Felaktig sökfras</h3>
    <p class="text-slate-600"><%= @query_error %></p>
  </div>
<% elsif @query.present? %>

  <% if @regex_results.present? %>
    <%= render 'regex_results' %>
  <% else %>
    <div class="bg-white rounded-lg shadow-lg overflow-hidden">
      <% if @results.any? %>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-slate-100">
            <tr>
              <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs sm:text-sm font-semibold text-slate-700 w-auto sm:w-48">
                <% if @sort_by == "reference_desc" %>
                  <%= link_to search_scrapes_path(q: @query, sort_by: "relevance"), class: "hover:text-blue-600" do %>
                    <%= t('search.table.reference') %> <span class="ml-1">▼</span>
                  <% end %>
                <% elsif @sort_by == "reference" %>
                  <%= link_to search_scrapes_path(q: @query, sort_by: "reference_desc"), class: "hover:text-blue-600" do %>
                    <%= t('search.table.reference') %> <span class="ml-1">▲</span>
                  <% end %>
                <% else %>
                  <%= link_to t('search.table.reference'), search_scrapes_path(q: @query, sort_by: "reference"), class: "hover:text-blue-600" %>
                <% end %>
              </th>
              <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs sm:text-sm font-semibold text-slate-700">
                <%= t('headings.results') %>: <%= @results.length %> <%= t('nouns.hit', count: @results.length) %>
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% @results.each do |res| %>
              <tr class="hover:bg-gray-50 transition">
                <td class="px-2 sm:px-4 py-2 sm:py-3 align-top whitespace-nowrap">
                  <%# Display complete reference with hierarchy - MONOSPACED %>
                  <div class="font-mono text-xs sm:text-sm">
                    <%= link_to res[:regulation_name], raw_scrape_path(res[:scrape], q: @query, focus_element_id: res[:element_id], anchor: "focus"), class: "text-blue-600 hover:text-blue-800 font-semibold", title: res[:subject] %>
                    <% if res[:complete_reference] != res[:regulation_name] %>
                      <br><span class="text-slate-600 whitespace-normal"><%= res[:complete_reference].sub(res[:regulation_name], "").gsub(/^, /, "") %></span>
                    <% end %>
                  </div>
                </td>
                <td class="px-2 sm:px-4 py-2 sm:py-3 align-top">
                  <%# Display element text with highlighted query - MONOSPACED %>
                  <p class="font-mono text-xs sm:text-sm text-slate-700 leading-relaxed"><%= highlight(res[:element_text], @query) %></p>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <div class="text-center py-12">
          <h3 class="text-xl font-semibold text-slate-700 mb-2"><%= t('search.empty.no_results') %></h3>
          <p class="text-slate-600"><%= t('search.empty.refine') %></p>
        </div>
      <% end %>
    </div>
  <% end %>
<% else %>
  <div class="text-center py-12 bg-white rounded-lg shadow">
    <h3 class="text-xl font-semibold text-slate-700 mb-2"><%= t('search.empty.start_search') %></h3>
    <p class="text-slate-600"><%= t('search.empty.start_tip') %></p>
  </div>
<% end %>
