<% content_for :title, "Dev: Reference Lookup" %>

<div class="max-w-6xl mx-auto">
  <div class="bg-white rounded-lg shadow-lg p-8">
    <div class="mb-6">
      <h1 class="text-4xl font-bold text-slate-800 mb-2">Dev: Reference Lookup</h1>
      <p class="text-slate-600">Development tool for looking up regulation references</p>
    </div>

    <%= form_with url: dev_reference_lookup_scrapes_path, method: :get, class: "mb-8" do |f| %>
      <div class="flex gap-4">
        <div class="flex-1">
          <%= text_field_tag :reference, @reference, 
              placeholder: "e.g., AFS 2023:10, 13 kap., 10 ยง", 
              class: "w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" %>
          <p class="text-sm text-slate-500 mt-2">
            Examples: <code class="bg-slate-100 px-2 py-1 rounded">AFS 2023:10, 13 kap., 10 ยง</code> or 
            <code class="bg-slate-100 px-2 py-1 rounded">AFS 2023:10, 13 kap., 10 ยง, AR</code>
          </p>
        </div>
        <%= submit_tag "Lookup", class: "px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition" %>
      </div>
    <% end %>

    <% if @error %>
      <div class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg mb-6">
        <p class="font-semibold">Error:</p>
        <p><%= @error %></p>
      </div>
    <% end %>

    <% if @result %>
      <div class="space-y-6">
        <!-- Navigation Buttons -->
        <% if @prev_reference || @next_reference %>
          <div class="flex justify-between items-center">
            <% if @prev_reference %>
              <%= link_to dev_reference_lookup_scrapes_path(reference: @prev_reference), class: "inline-flex items-center px-4 py-2 bg-slate-600 text-white font-semibold rounded-lg hover:bg-slate-700 transition" do %>
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                Previous Section
              <% end %>
            <% else %>
              <div></div>
            <% end %>
            
            <% if @next_reference %>
              <%= link_to dev_reference_lookup_scrapes_path(reference: @next_reference), class: "inline-flex items-center px-4 py-2 bg-slate-600 text-white font-semibold rounded-lg hover:bg-slate-700 transition" do %>
                Next Section
                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              <% end %>
            <% end %>
          </div>
        <% end %>

        <!-- Reference Info -->
        <div class="bg-slate-50 border border-slate-200 rounded-lg p-4">
          <h2 class="text-xl font-semibold text-slate-800 mb-2">Reference</h2>
          <dl class="grid grid-cols-2 gap-2 text-sm">
            <dt class="font-medium text-slate-600">Regulation:</dt>
            <dd class="text-slate-800"><%= @result[:regulation] %></dd>
            
            <% if @result[:chapter] %>
              <dt class="font-medium text-slate-600">Chapter:</dt>
              <dd class="text-slate-800"><%= @result[:chapter] %></dd>
            <% end %>
            
            <% if @result[:section] %>
              <dt class="font-medium text-slate-600">Section:</dt>
              <dd class="text-slate-800"><%= @result[:section] %> ยง</dd>
            <% end %>
            
            <dt class="font-medium text-slate-600">General Recommendation:</dt>
            <dd class="text-slate-800"><%= @result[:is_general_recommendation] ? "Yes (AR)" : "No" %></dd>
            
            <dt class="font-medium text-slate-600">Element Count:</dt>
            <dd class="text-slate-800"><%= @result[:elements].count %></dd>
          </dl>
        </div>

        <!-- Human Readable View -->
        <div class="border border-slate-200 rounded-lg">
          <div class="bg-slate-100 px-4 py-3 border-b border-slate-200">
            <h2 class="text-xl font-semibold text-slate-800">Human Readable</h2>
          </div>
          <div class="p-4">
            <div class="prose prose-slate max-w-none">
              <%= sanitize @result[:html], tags: %w[p h1 h2 h3 h4 h5 h6 ul ol li strong em br a span div table thead tbody tr th td], attributes: %w[class id href] %>
            </div>
          </div>
        </div>

        <!-- JSON View -->
        <div class="border border-slate-200 rounded-lg">
          <div class="bg-slate-100 px-4 py-3 border-b border-slate-200">
            <h2 class="text-xl font-semibold text-slate-800">JSON</h2>
          </div>
          <div class="p-4 bg-slate-50">
            <pre class="text-sm text-slate-800 overflow-x-auto"><code><%= JSON.pretty_generate({
              reference: @reference,
              regulation: @result[:regulation],
              chapter: @result[:chapter],
              section: @result[:section],
              is_general_recommendation: @result[:is_general_recommendation],
              element_count: @result[:elements].count,
              elements: @result[:elements].map do |element|
                {
                  id: element.id,
                  tag_name: element.tag_name,
                  text_content: element.text_content,
                  html_snippet: element.html_snippet,
                  regulation: element.regulation,
                  chapter: element.chapter,
                  section: element.section,
                  appendix: element.appendix,
                  is_general_recommendation: element.is_general_recommendation,
                  is_transitional: element.is_transitional,
                  position_in_parent: element.position_in_parent
                }
              end
            }) %></code></pre>
          </div>
        </div>

        <!-- Text View (Plain Text) -->
        <div class="border border-slate-200 rounded-lg">
          <div class="bg-slate-100 px-4 py-3 border-b border-slate-200">
            <h2 class="text-xl font-semibold text-slate-800">Plain Text</h2>
          </div>
          <div class="p-4 bg-slate-50">
            <pre class="text-sm text-slate-800 whitespace-pre-wrap"><%= @result[:text] %></pre>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
