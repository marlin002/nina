<% content_for :title, "Nina - Content Viewer" %>

<div class="scrapes-header">
  <h1>🏛️ Nina - Content Viewer</h1>
  <p class="subtitle">
    Scraped content from AV.se - <%= @stats[:total_scrapes] %> regulations available
  </p>
  <% if @stats[:last_updated] %>
    <p class="last-updated">
      <em>Last updated: <%= @stats[:last_updated].strftime("%Y-%m-%d at %H:%M") %></em>
    </p>
  <% end %>
  
  <div class="stats-summary">
    <div class="stat-item">
      <span class="stat-number"><%= @stats[:total_scrapes] %></span>
      <span class="stat-label">Regulations</span>
    </div>
    <div class="stat-item">
      <span class="stat-number"><%= number_to_human_size(@stats[:total_html_size]) %></span>
      <span class="stat-label">HTML Content</span>
    </div>
    <div class="stat-item">
      <span class="stat-number"><%= number_to_human_size(@stats[:total_text_size]) %></span>
      <span class="stat-label">Text Content</span>
    </div>
  </div>
</div>

<div class="regulation-grid">
  <% @scrapes.each do |scrape| %>
    <% regulation_num = scrape.source.url.match(/afs-2023(\d+)/)&.[](1) || "?" %>
    <div class="regulation-card">
      <div class="regulation-header">
        <h3>AFS 2023:<%= regulation_num %></h3>
        <div class="regulation-stats">
          <span class="stat">📄 <%= number_to_human_size(scrape.raw_html&.length || 0) %></span>
          <span class="stat">📝 <%= number_to_human_size(scrape.plain_text&.length || 0) %></span>
        </div>
      </div>
      
      <div class="regulation-meta">
        <div class="scrape-time">
          🕒 Scraped: <%= scrape.fetched_at&.strftime("%m-%d %H:%M") %>
        </div>
      </div>
      
      <div class="regulation-preview">
        <p><strong>Preview:</strong></p>
        <p class="preview-text">
          <%= truncate(scrape.plain_text&.strip, length: 150) %>
        </p>
      </div>
      
      <div class="regulation-actions">
        <%= link_to "View Details", scrape_path(scrape), class: "btn btn-primary" %>
        <%= link_to "Raw HTML", raw_scrape_path(scrape), class: "btn btn-secondary", target: "_blank" %>
        <%= link_to "Source", scrape.source.url, class: "btn btn-outline", target: "_blank" %>
      </div>
    </div>
  <% end %>
</div>

<% if @scrapes.empty? %>
  <div class="empty-state">
    <h3>No scraped content available</h3>
    <p>Run the scraping jobs to populate this page with content.</p>
    <pre><code>rails scrape:all</code></pre>
  </div>
<% end %>